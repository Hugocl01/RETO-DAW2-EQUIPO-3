<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: hooks/useCrud.jsx</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: hooks/useCrud.jsx</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { useState, useEffect } from "react";
import { generateSlug } from "../utils/stringUtils";

/**
 * Hook para gestionar operaciones CRUD dinámicamente.
 * @param {Object} seccion - Información de la entidad (ej: {nombre: "Equipos", acciones: [...]})
 * @returns {Object} - Estado y funciones para gestionar la entidad.
 */
export const useCrud = (seccion) => {
    const url = import.meta.env.VITE_API_URL;
    const [items, setItems] = useState([]);
    const [loading, setLoading] = useState(false);
    const [error, setError] = useState(null);
    const [columns, setColumns] = useState([]);
    const entidadNombre = generateSlug(seccion.nombre); // Convertir a slug

    /**
     * Obtiene los elementos de la entidad desde la API.
     * Se realiza una solicitud GET para obtener los datos.
     */
    const fetchItems = async () => {
        setLoading(true);
        setError(null);
        try {
            const response = await fetch(`${url}${entidadNombre}`, {
                method: 'GET',
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": `Bearer ${localStorage.getItem("token")}`
                }
            });
            if (!response.ok) {
                throw new Error("Error al obtener los datos.");
            }

            const data = await response.json();
            setItems(data[entidadNombre] || []);
            if (data[entidadNombre]?.length > 0) {
                setColumns(Object.keys(data[entidadNombre][0]));
            } else {
                setColumns([]);
            }
        } catch (err) {
            setError(err.message || "Error de red.");
        } finally {
            setLoading(false);
        }
    };

    /**
     * Crea un nuevo elemento.
     * Se realiza una solicitud POST para crear el elemento en la API.
     * 
     * @param {Object} newItem - Objeto con los datos del nuevo elemento.
     */
    const createItem = async (newItem) => {
        try {
            const response = await fetch(`${url}${entidadNombre}`, {
                method: 'POST',
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": `Bearer ${localStorage.getItem("token")}`
                },
                body: JSON.stringify(newItem)
            });

            if (!response.ok) {
                throw new Error("Error al crear el registro.");
            }

            fetchItems(); // Recargar la lista
        } catch (err) {
            setError(err.message || "Error al crear el registro.");
        }
    };

    /**
    * Actualiza un elemento existente.
    * Se realiza una solicitud PUT para actualizar el elemento en la API.
    * 
    * @param {number} id - ID del elemento a actualizar.
    * @param {Object} updatedItem - Objeto con los datos actualizados del elemento.
    */
    const updateItem = async (id, updatedItem) => {
        try {
            const response = await fetch(`${url}${entidadNombre}/${id}`, {
                method: 'PUT',
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": `Bearer ${localStorage.getItem("token")}`
                },
                body: JSON.stringify(updatedItem)
            });

            if (!response.ok) {
                throw new Error("Error al actualizar.");
            }

            fetchItems();
        } catch (err) {
            setError(err.message || "Error al actualizar.");
        }
    };

    /**
     * Elimina un elemento.
     * Se realiza una solicitud DELETE para eliminar el elemento de la API.
     * 
     * @param {number} id - ID del elemento a eliminar.
     */
    const deleteItem = async (id) => {
        try {
            const response = await fetch(`${url}${entidadNombre}/${id}`, {
                method: 'DELETE',
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": `Bearer ${localStorage.getItem("token")}`
                }
            });

            if (!response.ok) {
                throw new Error("Error al eliminar.");
            }

            fetchItems();
        } catch (err) {
            setError(err.message || "Error al eliminar.");
        }
    };

    /**
     * Guarda un nuevo elemento o actualiza uno existente.
     * Detecta si el objeto `formData` tiene un `id` para decidir si es una creación o una actualización.
     * 
     * @param {Object} formData - Datos del elemento. Si incluye un `id`, se actualiza; de lo contrario, se crea.
     */
    const onGuardar = (formData, modo) => {
        if (modo === "crear") {
            createItem(formData);
        } else if (modo === "editar") {
            updateItem(formData.id, formData); // Asegúrate de que el 'formData' tenga 'id' en modo edición
        }
    };

    useEffect(() => {
        if (seccion) {
            fetchItems();
        };
    }, [seccion]);

    return {
        items,
        loading,
        error,
        columns,
        fetchItems,
        createItem,
        updateItem,
        deleteItem,
        onGuardar,
    };
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#AppEnrutador">AppEnrutador</a></li><li><a href="global.html#AppLayout">AppLayout</a></li><li><a href="global.html#BaseLayout">BaseLayout</a></li><li><a href="global.html#Carousel">Carousel</a></li><li><a href="global.html#Clasificacion">Clasificacion</a></li><li><a href="global.html#CrudCentros">CrudCentros</a></li><li><a href="global.html#CrudCiclos">CrudCiclos</a></li><li><a href="global.html#CrudEquipos">CrudEquipos</a></li><li><a href="global.html#CrudEstudios">CrudEstudios</a></li><li><a href="global.html#CrudFamilias">CrudFamilias</a></li><li><a href="global.html#CrudImagenes">CrudImagenes</a></li><li><a href="global.html#CrudInscripciones">CrudInscripciones</a></li><li><a href="global.html#CrudJugadores">CrudJugadores</a></li><li><a href="global.html#CrudPartidos">CrudPartidos</a></li><li><a href="global.html#CrudPatrocinadores">CrudPatrocinadores</a></li><li><a href="global.html#CrudPublicaciones">CrudPublicaciones</a></li><li><a href="global.html#CrudRetos">CrudRetos</a></li><li><a href="global.html#CrudTorneos">CrudTorneos</a></li><li><a href="global.html#CrudUsuarios">CrudUsuarios</a></li><li><a href="global.html#CuadroClasificacion">CuadroClasificacion</a></li><li><a href="global.html#DetalleEstadisticaPage">DetalleEstadisticaPage</a></li><li><a href="global.html#Equipo">Equipo</a></li><li><a href="global.html#EquiposPage">EquiposPage</a></li><li><a href="global.html#ErrorPage">ErrorPage</a></li><li><a href="global.html#Footer">Footer</a></li><li><a href="global.html#FormularioCentros">FormularioCentros</a></li><li><a href="global.html#FormularioCiclos">FormularioCiclos</a></li><li><a href="global.html#FormularioEquipos">FormularioEquipos</a></li><li><a href="global.html#FormularioEstudios">FormularioEstudios</a></li><li><a href="global.html#FormularioFamilias">FormularioFamilias</a></li><li><a href="global.html#FormularioJugadores">FormularioJugadores</a></li><li><a href="global.html#FormularioPartidos">FormularioPartidos</a></li><li><a href="global.html#FormularioPatrocinadores">FormularioPatrocinadores</a></li><li><a href="global.html#FormularioPublicaciones">FormularioPublicaciones</a></li><li><a href="global.html#FormularioRetos">FormularioRetos</a></li><li><a href="global.html#FormularioUsuarios">FormularioUsuarios</a></li><li><a href="global.html#Galeria">Galeria</a></li><li><a href="global.html#GaleriaPage">GaleriaPage</a></li><li><a href="global.html#Header">Header</a></li><li><a href="global.html#InfoTorneo">InfoTorneo</a></li><li><a href="global.html#Inicio">Inicio</a></li><li><a href="global.html#InicioPage">InicioPage</a></li><li><a href="global.html#Inscribirse">Inscribirse</a></li><li><a href="global.html#InscribirsePage">InscribirsePage</a></li><li><a href="global.html#Jugador">Jugador</a></li><li><a href="global.html#JugadorLabel">JugadorLabel</a></li><li><a href="global.html#Login">Login</a></li><li><a href="global.html#LoginPage">LoginPage</a></li><li><a href="global.html#MenuAdministracion">MenuAdministracion</a></li><li><a href="global.html#Migas">Migas</a></li><li><a href="global.html#OrganizacionPage">OrganizacionPage</a></li><li><a href="global.html#Paginador">Paginador</a></li><li><a href="global.html#Paginator">Paginator</a></li><li><a href="global.html#Partido">Partido</a></li><li><a href="global.html#Partidos">Partidos</a></li><li><a href="global.html#PartidosPage">PartidosPage</a></li><li><a href="global.html#PerfilPage">PerfilPage</a></li><li><a href="global.html#Retos">Retos</a></li><li><a href="global.html#RutaPrivada">RutaPrivada</a></li><li><a href="global.html#SeguridadContext">SeguridadContext</a></li><li><a href="global.html#SeguridadProvider">SeguridadProvider</a></li><li><a href="global.html#Spinner">Spinner</a></li><li><a href="global.html#TablaEquipos">TablaEquipos</a></li><li><a href="global.html#TablaJugadores">TablaJugadores</a></li><li><a href="global.html#TablaPartidos">TablaPartidos</a></li><li><a href="global.html#TarjetaFormulario">TarjetaFormulario</a></li><li><a href="global.html#TorneoPage">TorneoPage</a></li><li><a href="global.html#YouTubeLiveIndicator">YouTubeLiveIndicator</a></li><li><a href="global.html#cargarOpciones">cargarOpciones</a></li><li><a href="global.html#fetchCentros">fetchCentros</a></li><li><a href="global.html#fetchCiclos">fetchCiclos</a></li><li><a href="global.html#fetchData">fetchData</a></li><li><a href="global.html#fetchEquipos">fetchEquipos</a></li><li><a href="global.html#fetchEstudios">fetchEstudios</a></li><li><a href="global.html#fetchFamilias">fetchFamilias</a></li><li><a href="global.html#fetchIncidencias">fetchIncidencias</a></li><li><a href="global.html#fetchTiposPerfil">fetchTiposPerfil</a></li><li><a href="global.html#generateSlug">generateSlug</a></li><li><a href="global.html#subirImagen">subirImagen</a></li><li><a href="global.html#useCrud">useCrud</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Thu Mar 06 2025 00:24:19 GMT+0100 (hora estándar de Europa central)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
